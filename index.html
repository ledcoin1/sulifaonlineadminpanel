<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel | Sulifa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

<div class="container mx-auto p-6">

  <h1 class="text-3xl font-bold mb-6">üëë Admin Panel</h1>

  <!-- Key -->
  <div class="mb-4">
    <label class="block font-semibold mb-1">ADMIN KEY:</label>
    <input id="adminKey" type="text" placeholder="12345" class="border rounded p-2 w-full">
  </div>

  <!-- Players List -->
  <div class="mb-6">
    <div class="flex justify-between items-center mb-2">
      <h2 class="text-xl font-semibold">üéÆ –û–π—ã–Ω—à—ã–ª–∞—Ä</h2>
      <button onclick="loadPlayers()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">–ñ–∞“£–∞—Ä—Ç—É</button>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white shadow rounded">
        <thead>
          <tr>
            <th class="py-2 px-4 border-b">tgId / userId</th>
            <th class="py-2 px-4 border-b">–ë–∞–ª–∞–Ω—Å</th>
            <th class="py-2 px-4 border-b">”®–∑–≥–µ—Ä—Ç—É</th>
          </tr>
        </thead>
        <tbody id="playersTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Add / Change Balance -->
  <div class="mb-6 bg-white p-4 rounded shadow">
    <h2 class="text-xl font-semibold mb-2">–ë–∞–ª–∞–Ω—Å ”©–∑–≥–µ—Ä—Ç—É</h2>
    <div class="flex flex-col md:flex-row gap-2">
      <input id="tgId" placeholder="tgId –Ω–µ–º–µ—Å–µ userId" class="border rounded p-2 flex-1">
      <input id="balance" placeholder="–ñ–∞“£–∞ –±–∞–ª–∞–Ω—Å" type="number" class="border rounded p-2 flex-1">
      <button onclick="setBalance()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">–°–∞“õ—Ç–∞—É</button>
    </div>
  </div>

</div>

<script>
const SERVER = "https://sulifaonlinerender.onrender.com";

function loadPlayers() {
  const key = document.getElementById("adminKey").value.trim();
  if (!key) return alert("ADMIN KEY –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑");

  fetch(`${SERVER}/admin/players?key=${key}`)
    .then(r => r.json())
    .then(data => {
      const tbody = document.getElementById("playersTable");
      tbody.innerHTML = "";
      data.forEach(p => {
        const id = p.tgId || p.telegramId || p.userId || "unknown";
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="py-2 px-4 border-b">${id}</td>
          <td class="py-2 px-4 border-b">${p.balance}</td>
          <td class="py-2 px-4 border-b">
            <button class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600"
              onclick="fillChange('${id}')">”®–∑–≥–µ—Ä—Ç—É</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(err => alert("“ö–∞—Ç–µ: " + err));
}

function fillChange(tgId) {
  document.getElementById("tgId").value = tgId;
}

function setBalance() {
  const key = document.getElementById("adminKey").value.trim();
  const tgId = document.getElementById("tgId").value.trim();
  const balance = Number(document.getElementById("balance").value);

  if (!key || !tgId || isNaN(balance)) return alert("–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑");

  fetch(`${SERVER}/admin/balance`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ tgId, balance, key })
  })
  .then(r => r.json())
  .then(() => {
    alert("–ë–∞–ª–∞–Ω—Å ”©–∑–≥–µ—Ä—Ç—ñ–ª–¥—ñ");
    loadPlayers();
  })
  .catch(err => alert("“ö–∞—Ç–µ: " + err));
}

// –ê–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ –∞–ª“ì–∞—à“õ—ã –∂“Ø–∫—Ç–µ—É
// loadPlayers(); // “õ–∞–∂–µ—Ç –±–æ–ª—Å–∞ uncomment
</script>

</body>
</html>
