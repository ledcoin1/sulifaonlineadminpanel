<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
  body { font-family: Arial; max-width: 600px; margin: 30px auto; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  input, button { padding: 5px; margin: 3px; }
</style>
</head>
<body>
<h2>Admin Panel – Ойыншылар және баланстар</h2>
<label>Admin Key:</label>
<input type="password" id="adminKey">
<button onclick="loadPlayers()">Кіру</button>

<div id="panel" style="display:none;">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Баланс</th>
        <th>Жаңарту</th>
      </tr>
    </thead>
    <tbody id="playersTable"></tbody>
  </table>
</div>

<script>
const backendURL = "https://sulifaonlinerender.onrender.com";

async function loadPlayers() {
  const key = document.getElementById("adminKey").value;
  if (!key) { alert("Admin Key енгізіңіз"); return; }

  const res = await fetch(`${backendURL}/allPlayers`, { headers: { "admin-key": key } });
  if (!res.ok) { alert("Қате немесе Unauthorized"); return; }
  const data = await res.json();

  const tbody = document.getElementById("playersTable");
  tbody.innerHTML = "";
  data.forEach(player => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${player.id}</td>
      <td><input type="number" value="${player.balance}" id="balance-${player.id}"></td>
      <td><button onclick="updateBalance('${player.id}')">Жаңарту</button></td>
    `;
    tbody.appendChild(tr);
  });
  document.getElementById("panel").style.display = "block";
}

async function updateBalance(id) {
  const newBalance = Number(document.getElementById(`balance-${id}`).value);
  const key = document.getElementById("adminKey").value;

  const res = await fetch(`${backendURL}/updateBalance`, {
    method: "POST",
    headers: { "Content-Type": "application/json", "admin-key": key },
    body: JSON.stringify({ id, balance: newBalance })
  });

  const data = await res.json();
  alert(`Баланс жаңартылды: ${data.balance}`);
}
</script>
</body>
</html>
